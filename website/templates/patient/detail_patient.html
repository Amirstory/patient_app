{% extends 'base.html' %}
{% load static %}

{% block title %}Détail Patient - {{ patient.nom }} {{ patient.prenom }}{% endblock %}

{% block extra_css %}
<style>
    .patient-detail-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
        background: #f8f9fa;
        min-height: 100vh;
    }

    /* Header avec photo et nom */
    .patient-header {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        display: flex;
        align-items: center;
        gap: 2rem;
    }

    .patient-photo-container {
        position: relative;
    }

    .patient-photo {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 3rem;
        border: 4px solid #e9ecef;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .patient-name-section h1 {
        font-size: 2.5rem;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 0.5rem;
    }

    .patient-id {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 0.4rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
        display: inline-block;
    }

    /* Rectangle d'informations */
    .patient-info-rectangle {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }

    .info-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 10px;
        border-left: 4px solid #667eea;
        transition: all 0.3s ease;
    }

    .info-item:hover {
        background: #e3f2fd;
        transform: translateX(5px);
    }

    .info-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1rem;
        flex-shrink: 0;
    }

    .info-content .info-label {
        font-size: 0.85rem;
        color: #6c757d;
        margin-bottom: 0.25rem;
        font-weight: 500;
    }

    .info-content .info-value {
        font-size: 1rem;
        font-weight: 600;
        color: #2c3e50;
    }

    .info-value a {
        color: inherit;
        text-decoration: none;
        transition: color 0.3s ease;
    }

    .info-value a:hover {
        color: #667eea;
    }

    /* Options cliquables - petits onglets */
    .patient-options {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 2rem;
        padding: 1rem 0;
        border-bottom: 2px solid #e9ecef;
    }

    .option-tab {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 25px;
        padding: 0.6rem 1.2rem;
        text-decoration: none;
        color: #6c757d;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.3s ease;
        cursor: pointer;
        white-space: nowrap;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .option-tab:hover {
        background: #e9ecef;
        color: #495057;
        text-decoration: none;
        transform: translateY(-1px);
    }

    .option-tab.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-color: #667eea;
    }

    .option-tab.medical:hover {
        background: #28a745;
        color: white;
        border-color: #28a745;
    }

    .option-tab.documents:hover {
        background: #17a2b8;
        color: white;
        border-color: #17a2b8;
    }

    .option-tab.appointments:hover {
        background: #ffc107;
        color: white;
        border-color: #ffc107;
    }

    .option-tab.prescriptions:hover {
        background: #6f42c1;
        color: white;
        border-color: #6f42c1;
    }

    .option-tab.payments:hover {
        background: #fd7e14;
        color: white;
        border-color: #fd7e14;
    }

    .option-tab i {
        font-size: 0.8rem;
    }

    /* Zone de contenu */
    .content-area {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        min-height: 300px;
        position: relative;
    }

    .content-section {
        display: none;
        animation: fadeIn 0.3s ease-in-out;
    }

    .content-section.active {
        display: block;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .content-placeholder {
        text-align: center;
        color: #6c757d;
        padding: 3rem 0;
    }

    .content-placeholder i {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.3;
    }

    .content-placeholder h3 {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        color: #495057;
    }

    .content-placeholder p {
        font-size: 1rem;
        opacity: 0.7;
    }

    /* Actions en bas */
    .bottom-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    .action-btn {
        padding: 0.75rem 1.5rem;
        border-radius: 25px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-edit {
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
    }

    .btn-edit:hover {
        background: linear-gradient(135deg, #218838, #1e7e34);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        color: white;
        text-decoration: none;
    }

    .btn-delete {
        background: linear-gradient(135deg, #dc3545, #e83e8c);
        color: white;
    }

    .btn-delete:hover {
        background: linear-gradient(135deg, #c82333, #d91a72);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        color: white;
    }

    .btn-back {
        background: #6c757d;
        color: white;
    }

    .btn-back:hover {
        background: #545b62;
        transform: translateY(-2px);
        color: white;
        text-decoration: none;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .patient-detail-container {
            padding: 1rem;
        }

        .patient-header {
            flex-direction: column;
            text-align: center;
            gap: 1rem;
        }

        .patient-name-section h1 {
            font-size: 2rem;
        }

        .info-grid {
            grid-template-columns: 1fr;
        }

        .patient-options {
            flex-wrap: wrap;
            justify-content: center;
        }

        .option-tab {
            font-size: 0.8rem;
            padding: 0.5rem 1rem;
        }

        .bottom-actions {
            flex-direction: column;
        }
    }

    /* Styles d'impression */
    @media print {
        .patient-options,
        .bottom-actions,
        .content-area {
            display: none !important;
        }
        
        .patient-detail-container {
            background: white !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="patient-detail-container">
    <!-- Header avec photo et nom -->
    <div class="patient-header">
        <div class="patient-photo-container">
            <div class="patient-photo">
                <i class="fas fa-user"></i>
            </div>
        </div>
        <div class="patient-name-section">
            <div class="patient-id">Patient #{{ patient.id }}</div>
            <h1>{{ patient.nom }} {{ patient.prenom }}</h1>
            <div style="color: #6c757d; margin-top: 0.5rem;">
                <i class="fas fa-calendar-plus me-1"></i>
                Patient depuis le {{ patient.date_creation|date:"d F Y" }}
            </div>
        </div>
    </div>

    <!-- Rectangle d'informations -->
    <div class="patient-info-rectangle">
        <div class="info-grid">
            <div class="info-item">
                <div class="info-icon">
                    <i class="fas fa-birthday-cake"></i>
                </div>
                <div class="info-content">
                    <div class="info-label">Âge</div>
                    <div class="info-value">{{ patient.age }} ans</div>
                </div>
            </div>

            <div class="info-item">
                <div class="info-icon">
                    <i class="fas fa-venus-mars"></i>
                </div>
                <div class="info-content">
                    <div class="info-label">Sexe</div>
                    <div class="info-value">{{ patient.sexe }}</div>
                </div>
            </div>

            <div class="info-item">
                <div class="info-icon">
                    <i class="fas fa-phone"></i>
                </div>
                <div class="info-content">
                    <div class="info-label">Téléphone</div>
                    <div class="info-value">
                        <a href="tel:{{ patient.telephone }}">{{ patient.telephone }}</a>
                    </div>
                </div>
            </div>

            {% if patient.email %}
            <div class="info-item">
                <div class="info-icon">
                    <i class="fas fa-envelope"></i>
                </div>
                <div class="info-content">
                    <div class="info-label">Email</div>
                    <div class="info-value">
                        <a href="mailto:{{ patient.email }}">{{ patient.email }}</a>
                    </div>
                </div>
            </div>
            {% endif %}

            <div class="info-item">
                <div class="info-icon">
                    <i class="fas fa-calendar"></i>
                </div>
                <div class="info-content">
                    <div class="info-label">Date de naissance</div>
                    <div class="info-value">{{ patient.date_naissance|date:"d/m/Y" }}</div>
                </div>
            </div>

            {% if patient.adresse %}
            <div class="info-item">
                <div class="info-icon">
                    <i class="fas fa-map-marker-alt"></i>
                </div>
                <div class="info-content">
                    <div class="info-label">Adresse</div>
                    <div class="info-value">{{ patient.adresse }}</div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Options cliquables - petits onglets -->
    <div class="patient-options">
        <a href="#" class="option-tab medical active" data-content="medical">
            <i class="fas fa-stethoscope"></i>
            Historique médical
        </a>

        <a href="#" class="option-tab documents" data-content="documents">
            <i class="fas fa-file-medical"></i>
            Documents médicaux
        </a>

        <a href="#" class="option-tab appointments" data-content="appointments">
            <i class="fas fa-calendar-check"></i>
            Rendez-vous
        </a>

        <a href="#" class="option-tab prescriptions" data-content="prescriptions">
            <i class="fas fa-prescription"></i>
            Ordonnances
        </a>

        <a href="#" class="option-tab payments" data-content="payments">
            <i class="fas fa-credit-card"></i>
            Historique des paiements
        </a>
    </div>

    <!-- Zone de contenu -->
    <div class="content-area">
        <!-- Contenu Historique médical -->
        <div id="medical-content" class="content-section active">
            <div class="content-placeholder">
                <i class="fas fa-stethoscope"></i>
                <h3>Historique médical</h3>
                <p>Le contenu de cette section sera ajouté prochainement</p>
            </div>
        </div>

        <!-- Contenu Documents médicaux -->
        <div id="documents-content" class="content-section">
            <div class="content-placeholder">
                <i class="fas fa-file-medical"></i>
                <h3>Documents médicaux</h3>
                <p>Le contenu de cette section sera ajouté prochainement</p>
            </div>
        </div>

        <!-- Contenu Rendez-vous -->
        <div id="appointments-content" class="content-section">
            <div class="content-placeholder">
                <i class="fas fa-calendar-check"></i>
                <h3>Rendez-vous</h3>
                <p>Le contenu de cette section sera ajouté prochainement</p>
            </div>
        </div>

        <!-- Contenu Ordonnances -->
        <div id="prescriptions-content" class="content-section">
            <div class="content-placeholder">
                <i class="fas fa-prescription"></i>
                <h3>Ordonnances</h3>
                <p>Le contenu de cette section sera ajouté prochainement</p>
            </div>
        </div>

        <!-- Contenu Historique des paiements -->
        <div id="payments-content" class="content-section">
            <div class="content-placeholder">
                <i class="fas fa-credit-card"></i>
                <h3>Historique des paiements</h3>
                <p>Le contenu de cette section sera ajouté prochainement</p>
            </div>
        </div>
    </div>

    <!-- Actions en bas -->
    <div class="bottom-actions">
        <a href="{% url 'modifier_patient' patient.id %}" class="action-btn btn-edit">
            <i class="fas fa-edit"></i>
            Modifier
        </a>

        <form method="POST" action="{% url 'supprimer_patient' patient.id %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" 
                    class="action-btn btn-delete"
                    onclick="return confirm('⚠️ SUPPRESSION DÉFINITIVE ⚠️\n\nVous allez supprimer :\n👤 {{ patient.nom }} {{ patient.prenom }}\n📞 {{ patient.telephone }}{% if patient.email %}\n📧 {{ patient.email }}{% endif %}\n\n❌ Cette action est IRRÉVERSIBLE !\n✅ Confirmer la suppression ?');">
                <i class="fas fa-trash"></i>
                Supprimer
            </button>
        </form>

        <a href="{% url 'liste_patients' %}" class="action-btn btn-back">
            <i class="fas fa-arrow-left"></i>
            Retour
        </a>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Récupérer tous les onglets et sections de contenu
    const tabs = document.querySelectorAll('.option-tab');
    const contentSections = document.querySelectorAll('.content-section');

    // Ajouter un événement de clic à chaque onglet
    tabs.forEach(tab => {
        tab.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Retirer la classe active de tous les onglets
            tabs.forEach(t => t.classList.remove('active'));
            
            // Ajouter la classe active à l'onglet cliqué
            this.classList.add('active');
            
            // Cacher toutes les sections de contenu
            contentSections.forEach(section => section.classList.remove('active'));
            
            // Afficher la section correspondante
            const contentType = this.getAttribute('data-content');
            const targetContent = document.getElementById(contentType + '-content');
            
            if (targetContent) {
                targetContent.classList.add('active');
            }
        });
    });
});
</script>
{% endblock %}